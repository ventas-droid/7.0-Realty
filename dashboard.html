<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Plataforma 7.0 ‚Äì Panel demostraci√≥n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    a { color: inherit; text-decoration: none; }
    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 1.2rem 1.5rem 0.8rem;
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: .6rem;
    }
    .logo-icon {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #38bdf8);
      display: grid;
      place-items: center;
      font-weight: 700;
      color: #0f172a;
      font-size: .85rem;
    }
    .logo-text small {
      font-size: .7rem;
      text-transform: uppercase;
      letter-spacing: .12em;
      color: #9ca3af;
    }
    .logo-text span {
      font-size: 1rem;
      font-weight: 600;
    }
    .header-actions {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
    }
    .chip {
      font-size: .7rem;
      padding: .25rem .7rem;
      border-radius: 999px;
      border: 1px solid #1f2937;
      color: #9ca3af;
    }
    .btn-mini {
      font-size: .75rem;
      padding: .3rem .75rem;
      border-radius: .75rem;
      border: 1px solid #1f2937;
      background: #0b1120;
      cursor: pointer;
    }
    main {
      flex: 1;
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 1.5rem 2rem;
    }
    .page-title {
      margin-bottom: .8rem;
    }
    .page-title h1 {
      font-size: 1.4rem;
      margin-bottom: .2rem;
    }
    .page-title p {
      font-size: .85rem;
      color: #9ca3af;
    }
    .tabs {
      display: flex;
      gap: .4rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .tab {
      font-size: .8rem;
      padding: .45rem .9rem;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      cursor: pointer;
      color: #cbd5f5;
    }
    .tab.active {
      background: #22c55e;
      color: #022c22;
      border-color: #22c55e;
      font-weight: 600;
    }
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 2fr);
      gap: 1.5rem;
    }
    @media (max-width: 860px) {
      .grid { grid-template-columns: minmax(0, 1fr); }
    }
    .card {
      background: #020617;
      border-radius: 1rem;
      border: 1px solid #1f2937;
      padding: 1rem 1rem 1.1rem;
      box-shadow: 0 18px 40px -30px rgb(15 23 42 / 0.95);
    }
    .card h2 {
      font-size: 1rem;
      margin-bottom: .25rem;
    }
    .card p {
      font-size: .85rem;
      color: #9ca3af;
      margin-bottom: .6rem;
    }
    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      margin-bottom: .7rem;
    }
    .badge {
      font-size: .7rem;
      padding: .25rem .6rem;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #0b1120;
      color: #cbd5f5;
    }
    .section-title {
      font-size: .85rem;
      font-weight: 600;
      margin: .8rem 0 .4rem;
    }

    /* Cabecera con filtros a la derecha */
    .section-header-row {
      margin-top: .8rem;
      margin-bottom: .4rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: .75rem;
    }
    .section-header-row .section-title {
      margin: 0;
    }

    /* Filtros de rangos 1‚Äì4, etc */
    .range-filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      font-size: .78rem;
    }
    .range-chip {
      border-radius: 999px;
      padding: .2rem .7rem;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
    }
    .range-chip.active {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.3);
      color: #e0f2fe;
    }

    /* Lista din√°mica de acciones activadas */
    .owner-actions-list {
      margin-top: .4rem;
      display: flex;
      flex-direction: column;
      gap: .35rem;
    }
    .owner-pill {
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: .32rem .75rem;
      display: inline-flex;
      align-items: center;
      gap: .45rem;
      font-size: .8rem;
      max-width: 100%;
    }
    .owner-pill-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #22c55e;
    }
    .owner-empty {
      font-size: .78rem;
      color: #9ca3af;
    }

    .list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .list li::before {
      content: "‚Ä¢ ";
      color: #22c55e;
    }
    .list li {
      font-size: .85rem;
      color: #e5e7eb;
      margin-bottom: .25rem;
    }
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: .8rem;
      margin-top: .4rem;
    }
    .service-item {
      font-size: .8rem;
      border-radius: .8rem;
      border: 1px solid #1f2937;
      background: #020617;
      padding: .75rem .8rem .8rem;
      display: flex;
      flex-direction: column;
      gap: .2rem;
      min-height: 140px;
    }
    .service-item strong {
      font-size: .86rem;
    }
    .service-meta {
      font-size: .74rem;
      color: #9ca3af;
    }
    .service-btn {
      margin-top:.6rem;
      padding:.45rem .85rem;
      border-radius:.6rem;
      border:1px solid #1f2937;
      background:#0b1120;
      color:#e5e7eb;
      font-size:.78rem;
      cursor:pointer;
      align-self:flex-start;
    }
    .service-btn-done {
      border-color:#38bdf8;
      background:#0b1120;
      color:#bfdbfe;
      cursor:default;
    }
    /* Bot√≥n dorado para servicios activados */
    .service-btn-gold {
      border-color:#facc15;
      background: radial-gradient(circle at top, #facc15, #92400e);
      color:#0f172a;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      gap:.35rem;
    }
    .service-btn-gold span.crown {
      font-size:.85rem;
    }
    /* Bot√≥n dorado especial de FULL ACCIONES */
    .service-btn-full {
      margin-top:.45rem;
      padding:.45rem 1rem;
      border-radius:.7rem;
      border:1px solid #fbbf24;
      background: radial-gradient(circle at top, #facc15, #b45309);
      color:#022c22;
      font-size:.8rem;
      font-weight:700;
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      cursor:pointer;
    }
    .service-btn-full span.crown {
      font-size:.9rem;
    }

    .toggle-row {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      margin-top: .9rem;
      font-size: .78rem;
    }
    .toggle {
      padding: .25rem .7rem;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #0b1120;
      display: inline-flex;
      align-items: center;
      gap: .25rem;
      cursor: default;
    }
    .toggle-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #4b5563;
    }

    /* Caja documentos / fotos */
    .upload-row {
      margin-top: .8rem;
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
      gap:.7rem;
    }
    .upload-card {
      border-radius:.9rem;
      border:1px dashed #1f2937;
      background:#020617;
      padding:.75rem .8rem .8rem;
      font-size:.8rem;
      transition:border-color .15s, background .15s;
    }
    .upload-card.active {
      border-color:#38bdf8;
      background:#020617;
    }
    .upload-title {
      font-weight:600;
      margin-bottom:.15rem;
    }
    .upload-sub {
      font-size:.76rem;
      color:#9ca3af;
      margin-bottom:.55rem;
    }
    .upload-btn {
      font-size:.78rem;
      padding:.4rem .8rem;
      border-radius:.6rem;
      border:1px solid #334155;
      background:#020617;
      color:#e5e7eb;
      cursor:pointer;
    }
    .upload-actions-row {
      margin-top:.6rem;
      display:flex;
      flex-wrap:wrap;
      gap:.45rem;
      font-size:.78rem;
    }
    .upload-view-btn {
      padding:.35rem .75rem;
      border-radius:.6rem;
      border:1px solid #1f2937;
      background:#020617;
      color:#e5e7eb;
      cursor:pointer;
    }

    /* Panel de previsualizaci√≥n */
    .upload-preview {
      margin-top:.6rem;
      border-radius:.9rem;
      border:1px solid #1f2937;
      background:#020617;
      padding:.65rem .8rem .8rem;
      font-size:.78rem;
    }
    .upload-preview-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:.4rem;
    }
    .upload-preview-title {
      font-weight:600;
    }
    .upload-preview-close {
      padding:.25rem .6rem;
      border-radius:.6rem;
      border:1px solid #1f2937;
      background:#020617;
      color:#e5e7eb;
      cursor:pointer;
      font-size:.75rem;
    }
    .upload-preview-grid {
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
    }
    .upload-thumb {
      position:relative;
      width:90px;
      height:90px;
      border-radius:.6rem;
      overflow:hidden;
      border:1px solid #1f2937;
      cursor:pointer;
    }
    .upload-thumb img {
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .upload-thumb-remove {
      position:absolute;
      top:3px;
      right:3px;
      background:rgba(15,23,42,.85);
      border-radius:999px;
      border:0;
      width:18px;
      height:18px;
      font-size:.7rem;
      color:#e5e7eb;
      cursor:pointer;
    }
    .upload-doc-item {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.5rem;
      padding:.3rem .5rem;
      border-radius:.4rem;
      border:1px solid #1f2937;
      margin-bottom:.25rem;
    }
    .upload-doc-name {
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:260px;
    }
    .upload-doc-remove {
      border-radius:.4rem;
      border:0;
      padding:.15rem .45rem;
      background:#450a0a;
      color:#fecaca;
      font-size:.7rem;
      cursor:pointer;
    }


    .kpis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: .6rem;
      margin-top: .6rem;
    }
    .kpi {
      border-radius: .8rem;
      border: 1px solid #1f2937;
      background: #020617;
      padding: .55rem .6rem;
    }
    .kpi label {
      display: block;
      font-size: .7rem;
      color: #9ca3af;
      margin-bottom: .1rem;
    }
    .kpi span {
      font-size: .9rem;
      font-weight: 600;
    }

    /* Caja total coste / neto */
    .cost-box {
      margin-top:1rem;
      border-radius:.9rem;
      border:1px solid #1f2937;
      background: radial-gradient(circle at top left, rgba(250,204,21,0.16), rgba(15,23,42,0.96));
      padding:.85rem .9rem;
      font-size:.8rem;
      display:flex;
      flex-direction:column;
      gap:.45rem;
    }
    .cost-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.5rem;
    }
    .cost-label {
      color:#e5e7eb;
      font-weight:500;
    }
    .cost-value {
      font-size:.9rem;
      font-weight:700;
      color:#facc15;
    }
    .cost-note {
      font-size:.75rem;
      color:#9ca3af;
      margin-top:.15rem;
    }
    .cost-note strong {
      color:#facc15;
    }
    .price-input {
      width:130px;
      padding:.25rem .4rem;
      border-radius:.4rem;
      border:1px solid #1f2937;
      background:#020617;
      color:#e5e7eb;
      font-size:.8rem;
      text-align:right;
    }

    .log {
      font-size: .78rem;
      margin-top: .6rem;
      max-height: 190px;
      overflow-y: auto;
      border-radius: .7rem;
      border: 1px dashed #1f2937;
      padding: .5rem .6rem;
      background: #020617;
    }
    .log-entry {
      margin-bottom: .25rem;
      color: #9ca3af;
    }
    .log-entry strong { color: #e5e7eb; }
    .hint {
      font-size: .75rem;
      color: #9ca3af;
      margin-top: .4rem;
    }
    footer {
      font-size: .7rem;
      color: #6b7280;
      padding: .75rem 1.5rem 1.3rem;
      max-width: 1100px;
      margin: 0 auto;
    }
    .agency-actions {
      margin-top: .8rem;
      border-top: 1px solid #1f2937;
      padding-top: .6rem;
    }
    .agency-actions p {
      margin-bottom: .4rem;
      font-size:.8rem;
      color:#9ca3af;
    }
    .agency-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
      gap:.5rem;
    }
    .agency-btn {
      margin-top:.35rem;
      font-size:.72rem;
      padding:.3rem .6rem;
      border-radius:.6rem;
      border:1px solid #1d4ed8;
      background:#020617;
      color:#bfdbfe;
      cursor:pointer;
    }
    .agency-btn:disabled {
      opacity:.7;
      cursor:default;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">
        <div class="logo-icon">7.0</div>
        <div class="logo-text">
          <small>Panel demostraci√≥n</small>
          <span>Plataforma 7.0</span>
        </div>
      </div>
      <div class="header-actions">
        <a href="index.html" class="btn-mini">‚Üê Volver a la p√°gina principal</a>
        <span class="chip">Prototipo visual ¬∑ sin datos reales de servidor</span>
      </div>
    </header>

    <main>
      <div class="page-title">
        <h1>Panel central de Plataforma 7.0</h1>
        <p>Vista simulada de c√≥mo se organiza la informaci√≥n para propietarios, agencias, difusores y auditor√≠a.</p>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="propietario">Propietario</button>
        <button class="tab" data-tab="agencia">Agencia / Profesional</button>
        <button class="tab" data-tab="difusor">Difusores / Creadores</button>
        <button class="tab" data-tab="auditor">Auditor√≠a</button>
      </div>

      <div class="grid">
        <!-- PANEL PROPIETARIO -->
<section id="panel-propietario" class="panel">
  <div class="card">
    <h2>Propietario ‚Äì √Åtico Blue Sunset</h2>
    <p>Resumen de la campa√±a de venta de una vivienda real dentro del sistema 7.0.</p>

    <div class="badge-row">
      <span class="badge">2 dorm ¬∑ 2 ba√±os</span>
      <span class="badge">Vistas al mar</span>
      <span class="badge">La Duquesa ¬∑ Manilva</span>
      <span class="badge">Campa√±a activa</span>
    </div>

    <!-- üîº CAJA SUBIR FOTOS / DOCUMENTACI√ìN (MOVIDA ARRIBA) -->
    <div class="section-title">Subir fotos y documentaci√≥n</div>

    <div class="upload-row">
      <div class="upload-card">
        <h3 class="upload-title">Subir fotos de la vivienda</h3>
        <p class="upload-sub">
          Arrastra aqu√≠ tus fotos o pulsa el bot√≥n para seleccionar archivos.
        </p>
        <div class="upload-drop" id="photos-drop">
          <button class="upload-btn" type="button" id="photos-upload">
            Subir / arrastrar fotos
          </button>
        </div>
      </div>

      <div class="upload-card">
        <h3 class="upload-title">Subir documentaci√≥n</h3>
        <p class="upload-sub">
          Escrituras, IBI, comunidad, certificado energ√©tico, etc.
        </p>
        <div class="upload-drop" id="docs-drop">
          <button class="upload-btn" type="button" id="docs-upload">
            Subir / arrastrar documentaci√≥n
          </button>
        </div>
      </div>
    </div>

    <div class="upload-actions-row">
      <button class="view-uploads-btn" type="button" id="view-photos-btn">
        Ver fotos subidas
      </button>
      <button class="view-uploads-btn" type="button" id="view-docs-btn">
        Ver documentaci√≥n subida
      </button>
    </div>

    <!-- ‚úÖ LISTA DIN√ÅMICA DE ACCIONES ACTIVADAS -->
    <div class="section-title">Acciones activadas por el propietario</div>
    <div id="owner-actions-badges" class="owner-actions-badges">
      <!-- Aqu√≠ se ir√°n a√±adiendo las acciones activadas (burbujas verdes) -->
    </div>

    <!-- CABECERA SERVICIOS + PAGINACI√ìN 4 EN 4 -->
    <div class="services-header-row">
      <div class="section-title" style="margin-bottom:0;">Servicios disponibles (tarifas ejemplo)</div>
      <div class="services-page-chips">
        <button class="page-chip active" data-page="all">Todos</button>
        <button class="page-chip" data-page="1">1‚Äì4</button>
        <button class="page-chip" data-page="2">5‚Äì8</button>
        <button class="page-chip" data-page="3">9‚Äì12</button>
        <button class="page-chip" data-page="4">13‚Äì16</button>
        <button class="page-chip" data-page="5">17‚Äì20</button>
        <button class="page-chip" data-page="6">21‚Äì24</button>
        <button class="page-chip" data-page="7">25‚Äì28</button>
      </div>
    </div>

    <!-- GRID DE SERVICIOS -->
    <div class="services-grid" id="services-grid">
      <!-- VISUAL / NARRATIVA BASE -->
      <div class="service-item" data-index="1">
        <strong>Fotos PRO</strong>
        <div class="service-meta">450 ‚Ç¨ ¬∑ pago a √©xito</div>
        <div class="service-meta">Fot√≥grafo especializado inmobiliario.</div>
        <button class="service-btn" data-service="fotos">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="2">
        <strong>V√≠deo + dron</strong>
        <div class="service-meta">450 ‚Ç¨ ¬∑ pago a √©xito</div>
        <div class="service-meta">Recorrido interior + vistas a√©reas.</div>
        <button class="service-btn" data-service="video">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="3">
        <strong>Home staging</strong>
        <div class="service-meta">750‚Äì1200 ‚Ç¨</div>
        <div class="service-meta">Mejora est√©tica sin reformas pesadas.</div>
        <button class="service-btn" data-service="staging">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="4">
        <strong>Blogger internacional</strong>
        <div class="service-meta">3000 ‚Ç¨ ¬∑ pago a √©xito</div>
        <div class="service-meta">Historia real en otro pa√≠s.</div>
        <button class="service-btn" data-service="blogger">Activar este servicio</button>
      </div>

      <!-- COMERCIAL / VISITAS -->
      <div class="service-item" data-index="5">
        <strong>Acompa√±amiento a visitas</strong>
        <div class="service-meta">50 ‚Ç¨ por visita</div>
        <div class="service-meta">Comercial 7.0 especializado, informe por visita.</div>
        <button class="service-btn" data-service="acomp_visitas">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="6">
        <strong>Atenci√≥n de llamadas</strong>
        <div class="service-meta">80‚Äì120 ‚Ç¨ / mes</div>
        <div class="service-meta">Filtro de compradores y agenda gestionada.</div>
        <button class="service-btn" data-service="atencion_llamadas">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="7">
        <strong>Gesti√≥n de agenda</strong>
        <div class="service-meta">100‚Äì150 ‚Ç¨ / mes</div>
        <div class="service-meta">Coordinaci√≥n de visitas y recordatorios.</div>
        <button class="service-btn" data-service="gestion_agenda">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="8">
        <strong>Informe semanal</strong>
        <div class="service-meta">30‚Äì50 ‚Ç¨ / mes</div>
        <div class="service-meta">Resumen de visitas, inter√©s y pr√≥ximos pasos.</div>
        <button class="service-btn" data-service="informe_semanal">Activar este servicio</button>
      </div>

      <!-- MARKETING / DIFUSI√ìN -->
      <div class="service-item" data-index="9">
        <strong>Campa√±a redes sociales</strong>
        <div class="service-meta">150 ‚Ç¨ gesti√≥n</div>
        <div class="service-meta">+ inversi√≥n desde 100 ‚Ç¨. Segmentaci√≥n internacional.</div>
        <button class="service-btn" data-service="campanas_redes">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="10">
        <strong>Red difusores locales</strong>
        <div class="service-meta">Hasta 1000 ‚Ç¨ a √©xito</div>
        <div class="service-meta">Compartido en redes y grupos reales.</div>
        <button class="service-btn" data-service="difusores_locales">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="11">
        <strong>Influencers extranjeros</strong>
        <div class="service-meta">2000‚Äì3000 ‚Ç¨ a √©xito</div>
        <div class="service-meta">Visibilidad en comunidades nicho internacionales.</div>
        <button class="service-btn" data-service="influencers_extranjeros">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="12">
        <strong>Tour virtual 3D</strong>
        <div class="service-meta">250‚Äì400 ‚Ç¨</div>
        <div class="service-meta">Recorrido completo en 360¬∫ de la vivienda.</div>
        <button class="service-btn" data-service="tour_3d">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="13">
        <strong>Reportaje nocturno</strong>
        <div class="service-meta">100‚Äì150 ‚Ç¨</div>
        <div class="service-meta">Fotos al atardecer para resaltar ambiente.</div>
        <button class="service-btn" data-service="reportaje_nocturno">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="14">
        <strong>Copywriting premium</strong>
        <div class="service-meta">50‚Äì80 ‚Ç¨</div>
        <div class="service-meta">Anuncio redactado como historia real.</div>
        <button class="service-btn" data-service="copywriting">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="15">
        <strong>Carta de venta</strong>
        <div class="service-meta">100‚Äì150 ‚Ç¨</div>
        <div class="service-meta">PDF profesional para compradores interesados.</div>
        <button class="service-btn" data-service="carta_venta">Activar este servicio</button>
      </div>

      <!-- T√âCNICO / LEGAL EXTRA -->
      <div class="service-item" data-index="16">
        <strong>Valoraci√≥n profesional</strong>
        <div class="service-meta">100‚Äì200 ‚Ç¨</div>
        <div class="service-meta">Informe de precio con comparables reales.</div>
        <button class="service-btn" data-service="valoracion_basica">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="17">
        <strong>Valoraci√≥n ampliada</strong>
        <div class="service-meta">150‚Äì300 ‚Ç¨</div>
        <div class="service-meta">Escenarios de precio, plazos y estrategia.</div>
        <button class="service-btn" data-service="valoracion_ampliada">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="18">
        <strong>Informe fiscal</strong>
        <div class="service-meta">150‚Äì200 ‚Ç¨</div>
        <div class="service-meta">C√°lculo de impuestos y neto final a cobrar.</div>
        <button class="service-btn" data-service="informe_fiscal">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="19">
        <strong>Certificado energ√©tico</strong>
        <div class="service-meta">50‚Äì80 ‚Ç¨</div>
        <div class="service-meta">Certificado obligatorio gestionado por t√©cnico.</div>
        <button class="service-btn" data-service="cert_energetico">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="20">
        <strong>Plano profesional</strong>
        <div class="service-meta">100‚Äì150 ‚Ç¨</div>
        <div class="service-meta">Plano 2D/3D claro y presentable.</div>
        <button class="service-btn" data-service="planos">Activar este servicio</button>
      </div>

      <!-- MEJORAS F√çSICAS / REFORMAS -->
      <div class="service-item" data-index="21">
        <strong>Limpieza profesional</strong>
        <div class="service-meta">50‚Äì120 ‚Ç¨</div>
        <div class="service-meta">Puesta a punto antes de fotos y visitas.</div>
        <button class="service-btn" data-service="limpieza">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="22">
        <strong>Peque√±os arreglos</strong>
        <div class="service-meta">100‚Äì400 ‚Ç¨</div>
        <div class="service-meta">Manitas: grifos, enchufes, persianas, detalles.</div>
        <button class="service-btn" data-service="pequenos_arreglos">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="23">
        <strong>Lavado de cara expr√©s</strong>
        <div class="service-meta">300‚Äì600 ‚Ç¨</div>
        <div class="service-meta">Pintura estrat√©gica y modernizaci√≥n r√°pida.</div>
        <button class="service-btn" data-service="lavado_cara">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="24">
        <strong>Optimizaci√≥n de terraza</strong>
        <div class="service-meta">200‚Äì600 ‚Ç¨</div>
        <div class="service-meta">Mobiliario b√°sico, textiles y plantas.</div>
        <button class="service-btn" data-service="optim_terraza">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="25">
        <strong>Reformas ligeras</strong>
        <div class="service-meta">Desde 500 ‚Ç¨</div>
        <div class="service-meta">Cambios con alto impacto visual.</div>
        <button class="service-btn" data-service="reformas_ligeras">Activar este servicio</button>
      </div>

      <!-- ACOMPA√ëAMIENTO 7.0 -->
      <div class="service-item" data-index="26">
        <strong>Asistente personal 7.0</strong>
        <div class="service-meta">60‚Äì90 ‚Ç¨ / sesi√≥n</div>
        <div class="service-meta">Acompa√±amiento por videollamada o tel√©fono.</div>
        <button class="service-btn" data-service="asistente_personal">Activar este servicio</button>
      </div>
      <div class="service-item" data-index="27">
        <strong>Gesti√≥n total 7.0</strong>
        <div class="service-meta">Hasta 3 % a √©xito</div>
        <div class="service-meta">Coordinaci√≥n integral hasta Notar√≠a ‚Äì Full acciones.</div>
        <button class="service-btn" data-service="gestion_total">Activar este servicio</button>
        <button class="service-btn-full" id="btn-full-acciones">
          <span class="crown">üëë</span>
          Full acciones 7.0
        </button>
      </div>
    </div>

    <!-- CAJA IMPORTE PROPIETARIO (se mantiene igual debajo) -->
    <div class="cost-box">
      <div class="cost-main">
        <div>
          <div class="cost-label">Precio de la propiedad</div>
          <input
            type="number"
            id="property-price"
            class="price-input"
            placeholder="Introduce el precio de venta (ej. 385000)"
          />
        </div>
        <div class="cost-values-col">
          <div class="cost-line">
            <span>Total servicios activados (sin IVA):</span>
            <span id="cost-servicios">0,00 ‚Ç¨</span>
          </div>
          <div class="cost-line">
            <span>IVA servicios 21 %:</span>
            <span id="cost-iva-servicios">0,00 ‚Ç¨</span>
          </div>
          <div class="cost-line">
            <span>Comisi√≥n 3 % gesti√≥n 7.0 (sin IVA):</span>
            <span id="cost-comision">0,00 ‚Ç¨</span>
          </div>
          <div class="cost-line">
            <span>IVA 21 % comisi√≥n:</span>
            <span id="cost-iva-comision">0,00 ‚Ç¨</span>
          </div>
          <div class="cost-line cost-line-strong">
            <span>Neto para el propietario (antes de plusval√≠a):</span>
            <span id="cost-neto">0,00 ‚Ç¨</span>
          </div>
        </div>
      </div>
      <p class="cost-note">
        C√°lculo orientativo en formato Espa√±a (puntos de miles, coma decimal). Se descuenta el coste de
        servicios activados, la comisi√≥n est√°ndar del 3 % sobre el precio y el 21 % de IVA correspondiente.
        No incluye plusval√≠a municipal, IRPF u otros impuestos.
      </p>
    </div>

    <p class="hint">
      El propietario ve esto como ‚Äúpanel de mando‚Äù: qu√© est√° activo, qu√© falta por activar y qu√© servicios ya han sido realizados.
    </p>
  </div>
</section>


        <!-- PANEL AGENCIA -->
        <section id="panel-agencia" class="panel" style="display:none;">
          <div class="card">
            <h2>Agencia 7.0 ‚Äì Centro de producci√≥n</h2>
            <p>Vista para agencias que dejan de vivir de exclusivas vac√≠as y pasan a producir resultados.</p>

            <div class="badge-row">
              <span class="badge">Equipo 7.0 Activo</span>
              <span class="badge">Comercial aut√≥nomo</span>
              <span class="badge">Abogado interno</span>
              <span class="badge">Valorador profesional</span>
            </div>

            <div class="section-title">Servicios que ofrece la agencia dentro de la plataforma</div>
            <ul class="list">
              <li>Acompa√±amiento a visitas: comercial aut√≥nomo cobra por visita cualificada.</li>
              <li>Valoraciones profesionales con informe completo de mercado.</li>
              <li>Gesti√≥n de reportajes y contenido audiovisual para varias viviendas a la vez.</li>
              <li>Coordinaci√≥n con bloggers, difusores y propietarios dentro del mismo sistema.</li>
            </ul>

            <div class="section-title">Acciones de profesionales sobre los servicios activos</div>
            <div class="agency-actions">
              <p>Ejemplo real de flujo 7.0: los profesionales marcan aqu√≠ cu√°ndo han completado su trabajo.</p>
              <div class="agency-grid">
                <div>
                  <strong>Fot√≥grafo</strong>
                  <div class="service-meta">Fotos PRO</div>
                  <button class="agency-btn" data-prof-service="fotos">Marcar fotos como entregadas</button>
                </div>
                <div>
                  <strong>Vide√≥grafo / dron</strong>
                  <div class="service-meta">V√≠deo + dron</div>
                  <button class="agency-btn" data-prof-service="video">Marcar v√≠deo como entregado</button>
                </div>
                <div>
                  <strong>Interiorista</strong>
                  <div class="service-meta">Home staging</div>
                  <button class="agency-btn" data-prof-service="staging">Marcar staging realizado</button>
                </div>
                <div>
                  <strong>Blogger internacional</strong>
                  <div class="service-meta">Publicaci√≥n historia</div>
                  <button class="agency-btn" data-prof-service="blogger">Marcar post publicado</button>
                </div>
                <div>
                  <strong>Abogado</strong>
                  <div class="service-meta">Revisi√≥n legal</div>
                  <button class="agency-btn" data-prof-service="legal">Marcar informe entregado</button>
                </div>
              </div>
            </div>

            <div class="kpis">
              <div class="kpi">
                <label>Propiedades activas</label>
                <span>12</span>
              </div>
              <div class="kpi">
                <label>Visitas esta semana</label>
                <span>24</span>
              </div>
              <div class="kpi">
                <label>Ventas cerradas mes</label>
                <span>3</span>
              </div>
              <div class="kpi">
                <label>Honorarios a cobrar</label>
                <span>18.500 ‚Ç¨</span>
              </div>
            </div>

            <p class="hint">
              La agencia ve el sistema como una f√°brica de resultados: menos escaparate, m√°s contenido, m√°s foco en servicios realizados y cierres reales.
            </p>
          </div>
        </section>

        <!-- PANEL DIFUSOR -->
        <section id="panel-difusor" class="panel" style="display:none;">
          <div class="card">
            <h2>Difusores y creadores</h2>
            <p>Personas que no son agentes, pero tienen audiencia y pueden ayudar a vender compartiendo historias reales.</p>

            <div class="badge-row">
              <span class="badge">Bloggers</span>
              <span class="badge">YouTubers</span>
              <span class="badge">Influencers</span>
              <span class="badge">Gente normal con redes</span>
            </div>

            <div class="section-title">C√≥mo funciona para un difusor</div>
            <ul class="list">
              <li>Se registra como difusor en la plataforma.</li>
              <li>Recibe un enlace o material de la vivienda para compartir en sus redes.</li>
              <li>Su tr√°fico se registra: clics, interesados, visitas programadas.</li>
              <li>Si la vivienda se vende y su difusi√≥n ha tenido impacto real, cobra una cantidad pactada.</li>
            </ul>

            <div class="section-title">Ejemplo de recompensa</div>
            <div class="services-grid">
              <div class="service-item">
                <strong>Difusor local</strong>
                <div class="service-meta">Publica en grupos y contactos</div>
                <div class="service-meta">Ejemplo: hasta 500‚Äì1000 ‚Ç¨ al cierre seg√∫n impacto.</div>
              </div>
              <div class="service-item">
                <strong>Influencer nicho extranjero</strong>
                <div class="service-meta">P√∫blico comprador de tu zona</div>
                <div class="service-meta">Ejemplo: 2000‚Äì3000 ‚Ç¨ a √©xito.</div>
              </div>
            </div>

            <div class="kpis">
              <div class="kpi">
                <label>Difusores activos</label>
                <span>14</span>
              </div>
              <div class="kpi">
                <label>Alcance estimado</label>
                <span>23.000</span>
              </div>
              <div class="kpi">
                <label>Viviendas con difusi√≥n 7.0</label>
                <span>8</span>
              </div>
            </div>

            <p class="hint">
              Todo el sistema est√° pensado para repartir valor: si tu difusi√≥n ayuda a vender, cobras. Si no, nadie te cobra ni cobra.
            </p>
          </div>
        </section>

        <!-- PANEL AUDITOR -->
        <section id="panel-auditor" class="panel" style="display:none;">
          <div class="card">
            <h2>Auditor√≠a 7.0</h2>
            <p>Una visi√≥n simple de c√≥mo se podr√≠a registrar qui√©n participa, qu√© se activa y qu√© se paga al cierre.</p>

            <div class="badge-row">
              <span class="badge">Registro de acciones</span>
              <span class="badge">Transparencia</span>
              <span class="badge">Preparado para notar√≠a</span>
            </div>

            <div class="kpis">
              <div class="kpi">
                <label>Acciones registradas</label>
                <span id="kpi-acciones">32</span>
              </div>
              <div class="kpi">
                <label>Profesionales implicados</label>
                <span>9</span>
              </div>
              <div class="kpi">
                <label>Difusores con impacto</label>
                <span>4</span>
              </div>
              <div class="kpi">
                <label>Importe a repartir</label>
                <span id="kpi-importe">12.300 ‚Ç¨</span>
              </div>
            </div>

            <div class="section-title">Ejemplo de ‚Äúregistro‚Äù de la vivienda</div>
            <div class="log" id="audit-log">
              <div class="log-entry"><strong>Propietario</strong> activa Fotos PRO (450 ‚Ç¨ a √©xito).</div>
              <div class="log-entry"><strong>Propietario</strong> activa V√≠deo + dron (450 ‚Ç¨ a √©xito).</div>
              <div class="log-entry"><strong>Agencia 7.0</strong> asigna comercial aut√≥nomo para visitas (50 ‚Ç¨/visita).</div>
              <div class="log-entry"><strong>Abogado</strong> registra revisi√≥n legal pendiente (250 ‚Ç¨ al cierre).</div>
              <div class="log-entry"><strong>Blogger FR</strong> publica historia sobre ‚Äú√°tico con vistas a √Åfrica‚Äù.</div>
              <div class="log-entry"><strong>Difusor local</strong> comparte la vivienda en grupos de la zona.</div>
              <div class="log-entry"><strong>Venta</strong>: se cierra operaci√≥n y se reparte el valor entre implicados.</div>
            </div>

            <p class="hint">
              En la versi√≥n completa, este panel se conectar√≠a a una base de datos y, si se quiere, a la notar√≠a para verificar que los pagos a √©xito quedan reflejados de forma justa.
            </p>
          </div>
        </section>
      </div>
    </main>

    <footer>
      Plataforma 7.0 ‚Äì Panel demostraci√≥n ¬∑ Esta p√°gina es un prototipo visual est√°tico pensado para explicar el sistema.
    </footer>
  </div>

  <script>
    // ----------- TABS -----------
    const tabs = document.querySelectorAll('.tab');
    const panels = document.querySelectorAll('.panel');

    function showTab(name){
      panels.forEach(p => {
        if(p.id === 'panel-' + name){ p.style.display = '' }
        else { p.style.display = 'none' }
      });
      tabs.forEach(t => {
        t.classList.toggle('active', t.dataset.tab === name);
      });
    }
    tabs.forEach(t => {
      t.addEventListener('click', () => showTab(t.dataset.tab));
    });
    showTab('propietario');

    // ----------- ESTADOS SERVICIOS -----------
    const serviceButtons = document.querySelectorAll('.service-btn[data-service]');
    const fullActionsBtn = document.getElementById('btn-full-acciones');
    const profButtons = document.querySelectorAll('.agency-btn');
    const toggles = document.querySelectorAll('[data-toggle]');
    const auditLog = document.getElementById('audit-log');
    const originalLogHTML = auditLog ? auditLog.innerHTML : '';
    const kpiAcciones = document.getElementById('kpi-acciones');
    const kpiImporte = document.getElementById('kpi-importe');

    const ownerActionsContainer = document.getElementById('owner-actions-dynamic');
    const ownerRangeChips = document.querySelectorAll('.owner-range-chip');
    let ownerActions = [];
    let currentOwnerRange = '1-4';

    const serviceRangeChips = document.querySelectorAll('.service-range-chip');
    const serviceItems = document.querySelectorAll('.service-item');
    let currentServiceRange = '1-4';

    const propertyPriceInput = document.getElementById('property-price');
    const costServicesBaseEl = document.getElementById('cost-services-base');
    const costServicesIvaEl = document.getElementById('cost-services-iva');
    const costCommissionBaseEl = document.getElementById('cost-commission-base');
    const costCommissionIvaEl = document.getElementById('cost-commission-iva');
    const costNetoEl = document.getElementById('cost-neto');
    // ----------- FOTOS / DOCUMENTOS (EN MEMORIA) -----------
    const photoDropzone = document.getElementById('photo-dropzone');
    const docDropzone   = document.getElementById('doc-dropzone');
    const photoInput    = document.getElementById('photo-input');
    const docInput      = document.getElementById('doc-input');
    const photoUploadBtn = document.getElementById('photo-upload-btn');
    const docUploadBtn   = document.getElementById('doc-upload-btn');
    const btnViewPhotos  = document.getElementById('btn-view-photos');
    const btnViewDocs    = document.getElementById('btn-view-docs');
    const photosPreview  = document.getElementById('photos-preview');
    const docsPreview    = document.getElementById('docs-preview');
    const photosPreviewGrid = document.getElementById('photos-preview-grid');
    const docsPreviewList   = document.getElementById('docs-preview-list');

    const previewCloseButtons = document.querySelectorAll('.upload-preview-close');

    let photoFiles = [];
    let docFiles   = [];

    function handleFiles(files, type) {
      const arr = Array.from(files);
      if (type === 'photo') {
        const valid = arr.filter(f => f.type.startsWith('image/'));
        photoFiles = photoFiles.concat(valid);
      } else {
        docFiles = docFiles.concat(arr);
      }
    }

    function renderPhotoPreview() {
      if (!photosPreviewGrid) return;
      photosPreviewGrid.innerHTML = '';
      if (photoFiles.length === 0) {
        photosPreviewGrid.textContent = 'No hay fotos subidas todav√≠a.';
        return;
      }
      photoFiles.forEach((file, index) => {
        const url = URL.createObjectURL(file);
        const wrapper = document.createElement('div');
        wrapper.className = 'upload-thumb';
        const img = document.createElement('img');
        img.src = url;
        img.alt = file.name;
        img.title = file.name;
        img.addEventListener('click', () => {
          window.open(url, '_blank');
        });
        const btn = document.createElement('button');
        btn.className = 'upload-thumb-remove';
        btn.textContent = '√ó';
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          photoFiles.splice(index, 1);
          renderPhotoPreview();
        });
        wrapper.appendChild(img);
        wrapper.appendChild(btn);
        photosPreviewGrid.appendChild(wrapper);
      });
    }

    function renderDocsPreview() {
      if (!docsPreviewList) return;
      docsPreviewList.innerHTML = '';
      if (docFiles.length === 0) {
        docsPreviewList.textContent = 'No hay documentos subidos todav√≠a.';
        return;
      }
      docFiles.forEach((file, index) => {
        const row = document.createElement('div');
        row.className = 'upload-doc-item';
        const name = document.createElement('span');
        name.className = 'upload-doc-name';
        name.textContent = file.name;
        const btn = document.createElement('button');
        btn.className = 'upload-doc-remove';
        btn.textContent = 'Eliminar';
        btn.addEventListener('click', () => {
          docFiles.splice(index, 1);
          renderDocsPreview();
        });
        row.appendChild(name);
        row.appendChild(btn);
        docsPreviewList.appendChild(row);
      });
    }

    function setupDropzone(zone, type) {
      if (!zone) return;
      ['dragenter','dragover'].forEach(evt => {
        zone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          zone.classList.add('active');
        });
      });
      ['dragleave','drop'].forEach(evt => {
        zone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          if (evt === 'drop') {
            const dt = e.dataTransfer;
            if (dt && dt.files && dt.files.length) {
              handleFiles(dt.files, type);
            }
          }
          zone.classList.remove('active');
        });
      });
    }

    setupDropzone(photoDropzone, 'photo');
    setupDropzone(docDropzone, 'doc');

    if (photoUploadBtn && photoInput) {
      photoUploadBtn.addEventListener('click', () => photoInput.click());
      photoInput.addEventListener('change', (e) => {
        handleFiles(e.target.files, 'photo');
        e.target.value = ''; // reset
      });
    }
    if (docUploadBtn && docInput) {
      docUploadBtn.addEventListener('click', () => docInput.click());
      docInput.addEventListener('change', (e) => {
        handleFiles(e.target.files, 'doc');
        e.target.value = '';
      });
    }

    if (btnViewPhotos && photosPreview) {
      btnViewPhotos.addEventListener('click', () => {
        renderPhotoPreview();
        photosPreview.style.display = 'block';
      });
    }
    if (btnViewDocs && docsPreview) {
      btnViewDocs.addEventListener('click', () => {
        renderDocsPreview();
        docsPreview.style.display = 'block';
      });
    }

    previewCloseButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.dataset.target;
        const panel = document.getElementById(targetId);
        if (panel) panel.style.display = 'none';
      });
    });
    const COMMISSION_RATE = 0.03;
    const IVA_RATE = 0.21;

    const estadosServicios = {};

    const serviceConfig = {
      fotos: {
        label: 'Fotos PRO',
        logOn: 'activa Fotos PRO (450 ‚Ç¨ a √©xito).',
        logDone: 'marca Fotos PRO como realizadas y entregadas.',
        importe: 450
      },
      video: {
        label: 'V√≠deo + dron',
        logOn: 'activa V√≠deo + dron (450 ‚Ç¨ a √©xito).',
        logDone: 'marca el v√≠deo + dron como entregado.',
        importe: 450
      },
      staging: {
        label: 'Home staging',
        logOn: 'solicita Home staging (750‚Äì1200 ‚Ç¨ a √©xito).',
        logDone: 'marca el Home staging como realizado en la vivienda.',
        importe: 900
      },
      blogger: {
        label: 'Blogger internacional',
        logOn: 'activa Blogger internacional (3000 ‚Ç¨ a √©xito).',
        logDone: 'confirma que el post del blogger internacional ha sido publicado.',
        importe: 3000
      },
      legal: {
        label: 'Revisi√≥n legal',
        logOn: 'solicita revisi√≥n legal (250 ‚Ç¨ al cierre).',
        logDone: 'marca la revisi√≥n legal como completada y lista para notar√≠a.',
        importe: 250
      },
      acomp_visitas: {
        label: 'Acompa√±amiento a visitas',
        logOn: 'activa acompa√±amiento profesional a visitas (50 ‚Ç¨ por visita).',
        logDone: 'marca que las visitas han sido acompa√±adas y reportadas.',
        importe: 200
      },
      atencion_llamadas: {
        label: 'Atenci√≥n de llamadas',
        logOn: 'activa servicio de atenci√≥n de llamadas y filtro de compradores.',
        logDone: 'marca que el servicio de llamadas ha sido prestado correctamente.',
        importe: 120
      },
      gestion_agenda: {
        label: 'Gesti√≥n de agenda',
        logOn: 'activa la gesti√≥n de agenda de visitas y recordatorios.',
        logDone: 'marca la gesti√≥n de agenda como realizada durante el periodo pactado.',
        importe: 150
      },
      informe_semanal: {
        label: 'Informe semanal',
        logOn: 'activa el informe semanal de estado de la venta.',
        logDone: 'marca que los informes semanales han sido entregados.',
        importe: 90
      },
      campanas_redes: {
        label: 'Campa√±a redes sociales',
        logOn: 'activa una campa√±a segmentada en redes sociales.',
        logDone: 'marca que la campa√±a en redes ha sido ejecutada.',
        importe: 150
      },
      difusores_locales: {
        label: 'Red difusores locales',
        logOn: 'activa la difusi√≥n en redes y grupos locales.',
        logDone: 'marca que la campa√±a con difusores locales se ha realizado.',
        importe: 500
      },
      influencers_extranjeros: {
        label: 'Influencers extranjeros',
        logOn: 'activa colaboraci√≥n con influencers extranjeros a √©xito.',
        logDone: 'marca que la campa√±a con influencers se ha publicado.',
        importe: 2500
      },
      tour_3d: {
        label: 'Tour virtual 3D',
        logOn: 'solicita la creaci√≥n de un tour virtual 3D.',
        logDone: 'marca el tour virtual 3D como entregado.',
        importe: 300
      },
      reportaje_nocturno: {
        label: 'Reportaje nocturno',
        logOn: 'activa reportaje fotogr√°fico al atardecer o nocturno.',
        logDone: 'marca el reportaje nocturno como realizado.',
        importe: 120
      },
      copywriting: {
        label: 'Copywriting premium',
        logOn: 'solicita redacci√≥n premium del anuncio.',
        logDone: 'marca el copywriting como entregado.',
        importe: 70
      },
      carta_venta: {
        label: 'Carta de venta',
        logOn: 'activa la creaci√≥n de una carta de venta en PDF.',
        logDone: 'marca la carta de venta como entregada.',
        importe: 130
      },
      valoracion_basica: {
        label: 'Valoraci√≥n profesional',
        logOn: 'activa una valoraci√≥n profesional b√°sica.',
        logDone: 'marca la valoraci√≥n profesional como entregada.',
        importe: 180
      },
      valoracion_ampliada: {
        label: 'Valoraci√≥n ampliada',
        logOn: 'activa una valoraci√≥n ampliada con estrategia.',
        logDone: 'marca la valoraci√≥n ampliada como entregada.',
        importe: 250
      },
      informe_fiscal: {
        label: 'Informe fiscal',
        logOn: 'solicita informe fiscal de la operaci√≥n.',
        logDone: 'marca el informe fiscal como entregado.',
        importe: 180
      },
      cert_energetico: {
        label: 'Certificado energ√©tico',
        logOn: 'activa la gesti√≥n del certificado energ√©tico.',
        logDone: 'marca el certificado energ√©tico como emitido.',
        importe: 80
      },
      planos: {
        label: 'Plano profesional',
        logOn: 'solicita plano profesional 2D/3D.',
        logDone: 'marca el plano profesional como entregado.',
        importe: 130
      },
      limpieza: {
        label: 'Limpieza profesional',
        logOn: 'activa limpieza profesional de la vivienda.',
        logDone: 'marca la limpieza profesional como realizada.',
        importe: 100
      },
      pequenos_arreglos: {
        label: 'Peque√±os arreglos',
        logOn: 'activa el servicio de peque√±os arreglos.',
        logDone: 'marca los arreglos como finalizados.',
        importe: 250
      },
      lavado_cara: {
        label: 'Lavado de cara expr√©s',
        logOn: 'activa el lavado de cara expr√©s.',
        logDone: 'marca la mejora expr√©s como realizada.',
        importe: 450
      },
      optim_terraza: {
        label: 'Optimizaci√≥n de terraza',
        logOn: 'activa la optimizaci√≥n est√©tica de la terraza.',
        logDone: 'marca la optimizaci√≥n de terraza como completada.',
        importe: 400
      },
      reformas_ligeras: {
        label: 'Reformas ligeras',
        logOn: 'activa un paquete de reformas ligeras.',
        logDone: 'marca las reformas ligeras como finalizadas.',
        importe: 800
      },
      asistente_personal: {
        label: 'Asistente personal 7.0',
        logOn: 'activa el servicio de asistente personal 7.0.',
        logDone: 'marca el acompa√±amiento 7.0 como realizado.',
        importe: 150
      },
      gestion_total: {
        label: 'Gesti√≥n total 7.0',
        logOn: 'activa gesti√≥n total 7.0 (3 % a √©xito).',
        logDone: 'marca la gesti√≥n total como realizada hasta notar√≠a.',
        importe: 0 // efecto va por la caja de comisi√≥n
      }
    };

    function fmt(num){
      return num.toLocaleString('es-ES',{
        minimumFractionDigits:2,
        maximumFractionDigits:2
      }) + ' ‚Ç¨';
    }

    function aplicarFiltroServicios() {
      serviceItems.forEach((item, idx) => {
        const index = idx + 1;
        let visible = true;
        if (currentServiceRange !== 'all') {
          const [startStr, endStr] = currentServiceRange.split('-');
          const start = parseInt(startStr,10);
          const end = parseInt(endStr,10);
          visible = index >= start && index <= end;
        }
        item.style.display = visible ? '' : 'none';
      });
    }

    function renderOwnerActionsPaged(){
      if (!ownerActionsContainer) return;
      ownerActionsContainer.innerHTML = '';

      if (ownerActions.length === 0) {
        const p = document.createElement('p');
        p.className = 'owner-empty';
        p.textContent = 'Todav√≠a no hay servicios activados. Activa alguno para ver aqu√≠ el resumen.';
        ownerActionsContainer.appendChild(p);
        return;
      }

      let from = 0;
      let to = ownerActions.length;
      if (currentOwnerRange !== 'all') {
        const [startStr, endStr] = currentOwnerRange.split('-');
        const start = parseInt(startStr,10) - 1;
        const end = parseInt(endStr,10);
        from = Math.max(0,start);
        to = Math.min(end, ownerActions.length);
      }

      const slice = ownerActions.slice(from, to);
      slice.forEach(text => {
        const div = document.createElement('div');
        div.className = 'owner-pill';
        const dot = document.createElement('span');
        dot.className = 'owner-pill-dot';
        const span = document.createElement('span');
        span.textContent = text;
        div.appendChild(dot);
        div.appendChild(span);
        ownerActionsContainer.appendChild(div);
      });
    }

    function recalcCosts(){
      if (!propertyPriceInput) return;
      const raw = propertyPriceInput.value.trim()
        .replace(/\./g,'')
        .replace(',', '.');
      const price = parseFloat(raw) || 0;

      let serviciosBase = 0;
      Object.keys(estadosServicios).forEach(id => {
        const state = estadosServicios[id];
        const cfg = serviceConfig[id];
        if (!cfg) return;
        if ((state === 'on' || state === 'done') && id !== 'gestion_total') {
          if (typeof cfg.importe === 'number') {
            serviciosBase += cfg.importe;
          }
        }
      });

      const serviciosIVA = serviciosBase * IVA_RATE;
      const comisionBase = price * COMMISSION_RATE;
      const comisionIVA = comisionBase * IVA_RATE;
      const neto = price - serviciosBase - serviciosIVA - comisionBase - comisionIVA;

      costServicesBaseEl.textContent = fmt(serviciosBase);
      costServicesIvaEl.textContent = fmt(serviciosIVA);
      costCommissionBaseEl.textContent = fmt(comisionBase);
      costCommissionIvaEl.textContent = fmt(comisionIVA);
      costNetoEl.textContent = fmt(neto > 0 ? neto : 0);
    }

    function renderServicios() {
      const estados = estadosServicios;

      // Botones propietario
      serviceButtons.forEach(btn => {
        const id = btn.dataset.service;
        const state = estados[id] || 'off';

        btn.classList.remove('service-btn-done','service-btn-gold');
        btn.disabled = false;
        btn.textContent = 'Activar este servicio';

        if (state === 'off') {
          // base
        } else if (state === 'on') {
          btn.classList.add('service-btn-gold');
          btn.innerHTML = '<span class="crown">üëë</span><span>Servicio activado</span>';
        } else if (state === 'done') {
          btn.textContent = 'Acci√≥n realizada';
          btn.classList.add('service-btn-done');
          btn.disabled = true;
        }
      });

      // Botones profesionales
      profButtons.forEach(btn => {
        const id = btn.dataset.profService;
        const state = estados[id] || 'off';
        if (state === 'done') {
          btn.disabled = true;
          btn.textContent = 'Acci√≥n ya marcada como realizada';
        } else {
          btn.disabled = false;
        }
      });

      // Toggles clave
      toggles.forEach(t => {
        const id = t.dataset.toggle;
        const dot = t.querySelector('.toggle-dot');
        if (!dot) return;
        const state = estados[id] || 'off';
        if (state === 'on' || state === 'done') {
          dot.style.background = '#22c55e';
          t.style.opacity = '1';
        } else {
          dot.style.background = '#4b5563';
          t.style.opacity = '.6';
        }
      });

      // Acciones din√°micas del propietario
      ownerActions = [];
      Object.keys(estados).forEach(id => {
        const state = estados[id];
        const cfg = serviceConfig[id];
        if (!cfg) return;
        if (state === 'on') {
          ownerActions.push(`${cfg.label} activado por el propietario`);
        } else if (state === 'done') {
          ownerActions.push(`${cfg.label} realizado por equipo 7.0`);
        }
      });
      renderOwnerActionsPaged();

      // Auditor√≠a + totales simples
      if (auditLog) {
        const ids = Object.keys(estados).filter(id => estados[id] === 'on' || estados[id] === 'done');
        if (ids.length === 0) {
          auditLog.innerHTML = originalLogHTML;
          if (kpiAcciones) kpiAcciones.textContent = '32';
          if (kpiImporte) kpiImporte.textContent = '12.300 ‚Ç¨';
        } else {
          auditLog.innerHTML = '';
          let totalImporte = 0;
          let countAcciones = 0;

          ids.forEach(id => {
            const cfg = serviceConfig[id];
            if (!cfg) return;
            const state = estados[id];
            const div = document.createElement('div');
            div.className = 'log-entry';

            if (state === 'on') {
              div.innerHTML = `<strong>Propietario</strong> ${cfg.logOn}`;
            } else if (state === 'done') {
              div.innerHTML = `<strong>Profesional 7.0</strong> ${cfg.logDone}`;
            }
            auditLog.appendChild(div);

            if (typeof cfg.importe === 'number' && cfg.importe > 0) {
              totalImporte += cfg.importe;
            }
            countAcciones++;
          });

          const extra = document.createElement('div');
          extra.className = 'log-entry';
          extra.innerHTML = '<strong>Nota</strong> ¬∑ Este registro es un ejemplo local. En la versi√≥n completa, cada acci√≥n se firma y verifica antes de llegar a notar√≠a.';
          auditLog.appendChild(extra);

          if (kpiAcciones) kpiAcciones.textContent = String(countAcciones);
          if (kpiImporte) kpiImporte.textContent = totalImporte.toLocaleString('es-ES') + ' ‚Ç¨';
        }
      }

      // Recalcular costes reales
      recalcCosts();
      // Aplicar filtro actual de servicios
      aplicarFiltroServicios();
    }

    // Click propietario: alterna off / on
    serviceButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.service;
        const current = estadosServicios[id] || 'off';
        if (current === 'done') return;

        if (current === 'off') {
          estadosServicios[id] = 'on';
        } else if (current === 'on') {
          estadosServicios[id] = 'off';
        }
        renderServicios();
      });
    });

    // FULL ACCIONES 7.0: activa todos en "on"
    if (fullActionsBtn) {
      fullActionsBtn.addEventListener('click', () => {
        Object.keys(serviceConfig).forEach(id => {
          estadosServicios[id] = 'on';
        });
        renderServicios();
      });
    }

    // Click del profesional: marca como "done"
    profButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.profService;
        const current = estadosServicios[id] || 'off';
        if (current === 'on' || current === 'off') {
          estadosServicios[id] = 'done';
          renderServicios();
        }
      });
    });

    // Filtros de servicios (1‚Äì4, etc.)
    serviceRangeChips.forEach(chip => {
      chip.addEventListener('click', () => {
        serviceRangeChips.forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        currentServiceRange = chip.dataset.serviceRange;
        aplicarFiltroServicios();
      });
    });

    // Filtros de acciones del propietario
    ownerRangeChips.forEach(chip => {
      chip.addEventListener('click', () => {
        ownerRangeChips.forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        currentOwnerRange = chip.dataset.ownerRange;
        renderOwnerActionsPaged();
      });
    });

    // Cambio de precio de propiedad
    if (propertyPriceInput) {
      propertyPriceInput.addEventListener('input', recalcCosts);
    }

    // Render inicial
    aplicarFiltroServicios();
    renderServicios();
  </script>
</body>
</html>
